# –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –∏ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

## üìä –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å (job `9dxhdazz0woxj1`)

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 450.43 —Å–µ–∫—É–Ω–¥ = **7 –º–∏–Ω—É—Ç 30 —Å–µ–∫—É–Ω–¥**

### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è: LowVRAM –∞–∫—Ç–∏–≤–µ–Ω
- **–ü—Ä–∏–∑–Ω–∞–∫–∏:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π `lowvram: loaded module regularly` –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –º–æ–¥–µ–ª–∏
- **–í–ª–∏—è–Ω–∏–µ:** –†–∞–±–æ—Ç–∞ –≤ 5-10 —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º —Å –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ GPU
- **–ü—Ä–∏—á–∏–Ω–∞:** –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ GPU –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ–±—Ä–∞–∑ –Ω–µ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω)
- **–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ –≤ `nodes.py`, –¥–æ–±–∞–≤–∏—Ç—å `"load_device": "main_device"` –≤ workflow

#### ‚ö†Ô∏è –í–∏–¥–µ–æ –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ base64
- **–ü—Ä–∏–∑–Ω–∞–∫:** `Encoded wan2.2_00001.mp4 as base64`
- **–í–ª–∏—è–Ω–∏–µ:** 
  - Base64 —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ –Ω–∞ ~33%
  - –ú–µ–¥–ª–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
  - –ú–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç—ã RunPod (10MB –¥–ª—è `/run`, 20MB –¥–ª—è `/runsync`)
- **–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ `FORCE_S3_VIDEO=true` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –≤ S3

#### ‚ö†Ô∏è HTTP /view –≤–º–µ—Å—Ç–æ —á—Ç–µ–Ω–∏—è —Å –¥–∏—Å–∫–∞
- **–ü—Ä–∏–∑–Ω–∞–∫:** `Fetching image data: type=output, subfolder=, filename=wan2.2_00001.mp4`
- **–í–ª–∏—è–Ω–∏–µ:** HTTP overhead –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ –Ω–∞ 2-5x)
- **–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞ —Å fallback –Ω–∞ HTTP /view

#### ‚ö†Ô∏è SageAttention –≤–º–µ—Å—Ç–æ SDPA
- **–ü—Ä–∏–∑–Ω–∞–∫:** `Patching comfy attention to use sageattn`
- **–í–ª–∏—è–Ω–∏–µ:** 
  - –¢—Ä–µ–±—É–µ—Ç –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ CUDA —è–¥–µ—Ä
  - –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –Ω–æ–≤—ã—Ö GPU (RTX 5090)
  - –ú–µ–¥–ª–µ–Ω–Ω–µ–µ SDPA –¥–ª—è WAN –º–æ–¥–µ–ª–µ–π
- **–†–µ—à–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `attention_mode="sdpa"` –≤ workflow (—Å–º. `WORKFLOW-OPTIMIZATION-TIPS.md`)

#### ‚ö†Ô∏è –ú–Ω–æ–∂–µ—Å—Ç–≤–æ WebSocket timeout'–æ–≤
- **–ü—Ä–∏–∑–Ω–∞–∫–∏:** `Websocket receive timed out. Still waiting...` (–º–Ω–æ–≥–æ —Ä–∞–∑)
- **–í–ª–∏—è–Ω–∏–µ:** –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –¥–æ–ª–≥–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å timeout'—ã websocket, –≤–æ–∑–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `WEBSOCKET_RECONNECT_DELAY_S`

## üìà –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Ä–∞–∑–±–∏–≤–∫–∞)

–ò–∑ –ª–æ–≥–æ–≤ –≤–∏–¥–Ω–æ:
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è:** ~2 –º–∏–Ω—É—Ç—ã 16 —Å–µ–∫—É–Ω–¥ (`100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [02:16<00:00, 67.45s/it]`)
- **–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏:** ~30 —Å–µ–∫—É–Ω–¥ (LowVRAM –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π)
- **–ü—Ä–æ—á–µ–µ:** –û—Å—Ç–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ, –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
1. **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ LowVRAM:** -70-80% –≤—Ä–µ–º–µ–Ω–∏ (—Å 7.5 –º–∏–Ω—É—Ç –¥–æ 1.5-2 –º–∏–Ω—É—Ç)
2. **S3 –≤–º–µ—Å—Ç–æ base64:** -30-90 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
3. **–ß—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞:** -5-10 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
4. **SDPA –≤–º–µ—Å—Ç–æ SageAttention:** -10-30% –≤—Ä–µ–º–µ–Ω–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ —É–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

1. ‚úÖ **–ß—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `handler.py`
2. ‚úÖ **FORCE_S3_VIDEO** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ –≤ S3
3. ‚úÖ **tcmalloc** - –¥–æ–±–∞–≤–ª–µ–Ω –≤ Dockerfile
4. ‚úÖ **NVENC –ø—Ä–æ–≤–µ—Ä–∫–∞** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `start.sh`

## ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ workflow

1. ‚ö†Ô∏è **–î–æ–±–∞–≤–∏—Ç—å `"load_device": "main_device"`** –≤ –Ω–æ–¥—ã `UnetLoaderGGUF` (41 –∏ 42)
2. ‚ö†Ô∏è **–ò–∑–º–µ–Ω–∏—Ç—å `attention_mode` –Ω–∞ `"sdpa"`** –≤ WAN –Ω–æ–¥–∞—Ö
3. ‚ö†Ô∏è **–ü—Ä–∏–º–µ–Ω–∏—Ç—å Lightning LoRA** (—Å–º. `WORKFLOW-OPTIMIZATION-TIPS.md`)
4. ‚ö†Ô∏è **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GGUF –º–æ–¥–µ–ª–∏** —Å `load_device="main_device"`
5. ‚ö†Ô∏è **–û—Ç–∫–ª—é—á–∏—Ç—å Frame Interpolation** –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—å –∫—Ä–∞—Ç–Ω–æ—Å—Ç—å
6. ‚ö†Ô∏è **–°–Ω–∏–∑–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ/FPS/–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

| –¢–µ–∫—É—â–µ–µ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π |
|---------|-------------------|
| 7 –º–∏–Ω—É—Ç 30 —Å–µ–∫—É–Ω–¥ | 1-2 –º–∏–Ω—É—Ç—ã |

**–†–∞–∑–±–∏–≤–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π:**
- LowVRAM –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ: -70-80% (—Å 7.5 –º–∏–Ω –¥–æ 1.5-2 –º–∏–Ω)
- S3 –≤–º–µ—Å—Ç–æ base64: -30-90 —Å–µ–∫ –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç
- –ß—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞: -5-10 —Å–µ–∫ –Ω–∞ –∑–∞–ø—Ä–æ—Å
- SDPA –≤–º–µ—Å—Ç–æ SageAttention: -10-30% –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

